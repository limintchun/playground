# IMPORTANT WARNING THIS MAKEFILE HAS BEEN MADE FOR DEBUG ONLY BECAUSE IT HAS
# BEEN GENERATED BY AI AND IT HAS DO BE DONE BY OURSELVES LATER IN THIS PROJECT

# Compiler and flags
CXX = g++
CXXFLAGS = -std=c++17 -Wall -Wextra -pedantic -g -pthread
INCLUDES = -I.
LDFLAGS = -lboost_system -pthread -lsqlite3

# Sanitizer options
TSAN_FLAGS = -fsanitize=thread

# Directories
SRCDIR = .
BUILDDIR = build
BINDIR = bin

# Create directories if they don't exist
$(shell mkdir -p $(BUILDDIR))
$(shell mkdir -p $(BINDIR))

# Source files
SERVER_SRCS = $(SRCDIR)/main_server.cpp $(SRCDIR)/SocialManager.cpp ../database/*.cpp
CLIENT_SRCS = $(SRCDIR)/main_client.cpp $(SRCDIR)/Client.cpp

# Header files
HEADERS = $(wildcard $(SRCDIR)/*.h)

# Object files
SERVER_OBJS = $(patsubst $(SRCDIR)/%.cpp,$(BUILDDIR)/%.o,$(SERVER_SRCS))
CLIENT_OBJS = $(patsubst $(SRCDIR)/%.cpp,$(BUILDDIR)/%.o,$(CLIENT_SRCS))

# Executables
SERVER_TARGET = $(BINDIR)/server
CLIENT_TARGET = $(BINDIR)/client

# Targets
all: $(SERVER_TARGET) $(CLIENT_TARGET)

# Different debug variants
tsan: CXXFLAGS += $(TSAN_FLAGS)
tsan: LDFLAGS += $(TSAN_FLAGS)
tsan: all

# For backward compatibility
debug: asan

$(SERVER_TARGET): $(SERVER_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(LDFLAGS)

$(CLIENT_TARGET): $(CLIENT_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(LDFLAGS)

# Rule that includes header dependencies
$(BUILDDIR)/%.o: $(SRCDIR)/%.cpp $(HEADERS)
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

clean:
	rm -rf $(BUILDDIR)/*.o $(SERVER_TARGET) $(CLIENT_TARGET)

.PHONY: all debug tsan asan ubsan clean